---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Simulador de Venta">
    <main style="max-width: 500px; margin: 60px auto; font-family: sans-serif; padding: 20px;">
        <div style="border: 5px solid #000; padding: 30px; border-radius: 20px; background: white; box-shadow: 10px 10px 0px #2ecc71;">
            <h1 style="text-transform: uppercase; font-weight: 900; margin-bottom: 10px;">üöÄ Simulador de Venta</h1>
            <p style="font-size: 12px; color: #666; margin-bottom: 20px;">Esto enviar√° un mensaje real a tu Telegram usando la l√≥gica del sistema.</p>
            
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <div style="background: #f0f0f0; padding: 15px; border-radius: 10px; font-size: 13px;">
                    <strong>Datos a enviar:</strong><br>
                    ‚Ä¢ Cliente: Test AMG<br>
                    ‚Ä¢ Monto: $89.990<br>
                    ‚Ä¢ Producto: Jordan 4 Black Cat
                </div>

                <button id="simulate-btn" 
                    style="width: 100%; background: #2ecc71; color: white; padding: 20px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 16px;">
                    Simular Pago Aprobado
                </button>
            </div>

            <div id="result-box" style="display: none; margin-top: 20px; padding: 15px; border-radius: 10px; border: 2px solid black; text-align: center;">
                <span id="result-text">Procesando...</span>
            </div>
        </div>
    </main>

    <script is:inline>
        // TUS CREDENCIALES VALIDADAS
        const TOKEN = '8170505944:AAEYPu3FtEv1x5aduVXmVOThymzBWyy4zIU';
        const CHAT_ID = '7430626322';

        document.getElementById('simulate-btn').onclick = async function() {
            const btn = this;
            const box = document.getElementById('result-box');
            const txt = document.getElementById('result-text');

            btn.disabled = true;
            btn.innerText = "ENVIANDO...";
            box.style.display = "block";
            box.style.background = "#eee";

            // 1. Construimos el mensaje tal cual lo har√° el Webhook
            const mensaje = `
üö® <b>NUEVA VENTA SIMULADA</b> üö®
‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ
üí∞ <b>Monto:</b> $89.990
üí≥ <b>ID Pago:</b> <code>TEST_PAYMENT_123</code>
üÜî <b>ID Orden:</b> <code>#AMG-999</code>

üì¶ <b>PRODUCTOS:</b>
üëü <b>Jordan 4 Black Cat</b>
   ‚îú Talla: 42
   ‚îî Precio: $89.990

üë§ <b>CLIENTE:</b>
Nombre: Juan Test
Estado: ‚úÖ <b>PAGADO</b>
‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ
<i>AMG SHOES SYSTEM</i>`;

            try {
                // 2. Intentamos el env√≠o
                const response = await fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: mensaje,
                        parse_mode: 'HTML'
                    })
                });

                const data = await response.json();

                if (data.ok) {
                    box.style.background = "#2ecc71";
                    txt.innerText = "‚úÖ ¬°LLEG√ì A TELEGRAM!";
                    btn.innerText = "SIMULAR OTRA VEZ";
                } else {
                    box.style.background = "#ff4d4d";
                    txt.innerText = "‚ùå ERROR: " + data.description;
                    btn.innerText = "REINTENTAR";
                }
            } catch (err) {
                box.style.background = "#000";
                box.style.color = "#fff";
                txt.innerText = "‚ùå ERROR DE RED";
                btn.innerText = "REINTENTAR";
            } finally {
                btn.disabled = false;
            }
        };
    </script>
</Layout>