---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import ProductCard from '../components/ProductCard.astro';
import { productos } from '../data/products';

// Extraer todas las etiquetas únicas para los botones de filtro
const todasLasEtiquetas = [...new Set(productos.flatMap(p => p.tags))].sort();
---

<Layout title="Colección | AMG SNEAKERS">
    <Header />
    <main class="py-12 md:py-20 font-['Inter']">
        <div class="max-w-7xl mx-auto px-6">
            
            <div class="mb-16 space-y-8">
                <h1 class="text-5xl md:text-7xl font-[900] uppercase italic tracking-tighter leading-none text-black">Explorar Catálogo</h1>
                
                <div class="flex flex-col md:flex-row gap-6 items-center justify-between bg-gray-50 p-6 rounded-[30px] border border-gray-100">
                    <div class="relative w-full md:w-1/3">
                        <input type="text" id="search-input" placeholder="BUSCAR POR MODELO..." class="w-full bg-white border-2 border-transparent focus:border-black rounded-2xl px-6 py-4 outline-none font-bold uppercase text-[11px] tracking-widest transition-all" />
                    </div>

                    <div class="flex flex-wrap gap-2 justify-center">
                        <button class="filter-btn active px-5 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all border-2 border-black bg-black text-white" data-filter="all">TODOS</button>
                        {todasLasEtiquetas.map(tag => (
                            <button class="filter-btn px-5 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all border-2 border-transparent bg-white text-gray-400 hover:border-black hover:text-black shadow-sm" data-filter={tag.toLowerCase()}>
                                {tag}
                            </button>
                        ))}
                    </div>
                </div>
            </div>

            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10">
                {productos.map((prod) => (
                    <ProductCard {...prod} />
                ))}
            </div>

            <div id="no-results" class="hidden text-center py-20">
                <p class="text-gray-400 font-black uppercase italic tracking-tighter text-2xl">No se encontraron modelos para tu búsqueda.</p>
            </div>
        </div>
    </main>
</Layout>

<script>
    const searchInput = document.getElementById('search-input') as HTMLInputElement;
    const filterBtns = document.querySelectorAll('.filter-btn');
    const products = document.querySelectorAll('.product-item');
    const noResults = document.getElementById('no-results');

    let currentFilter = 'all';
    let currentSearch = '';

    function filterProducts() {
        let visibleCount = 0;

        products.forEach(item => {
            const el = item as HTMLElement;
            const name = el.dataset.name || '';
            const tags = (el.dataset.tags || '').toLowerCase().split(',');

            const matchesSearch = name.includes(currentSearch.toLowerCase());
            const matchesFilter = currentFilter === 'all' || tags.includes(currentFilter.toLowerCase());

            if (matchesSearch && matchesFilter) {
                el.classList.remove('hidden');
                visibleCount++;
            } else {
                el.classList.add('hidden');
            }
        });

        noResults?.classList.toggle('hidden', visibleCount > 0);
    }

    // Evento Buscador
    searchInput?.addEventListener('input', (e) => {
        currentSearch = (e.target as HTMLInputElement).value;
        filterProducts();
    });

    // Evento Filtros de Botón
    filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            filterBtns.forEach(b => {
                b.classList.remove('bg-black', 'text-white', 'border-black');
                b.classList.add('bg-white', 'text-gray-400', 'border-transparent');
            });
            btn.classList.replace('bg-white', 'bg-black');
            btn.classList.replace('text-gray-400', 'text-white');
            btn.classList.add('border-black');
            
            currentFilter = (btn as HTMLElement).dataset.filter || 'all';
            filterProducts();
        });
    });
</script>